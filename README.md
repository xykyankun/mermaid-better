# Mermaid Better

> ğŸ¨ åœ¨çº¿ Mermaid å›¾è¡¨ç¼–è¾‘å™¨ - å®æ—¶é¢„è§ˆã€äº‘ç«¯å­˜å‚¨ã€åä½œåˆ†äº«

ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ Mermaid å›¾è¡¨åœ¨çº¿ç¼–è¾‘å™¨ï¼Œæ”¯æŒå®æ—¶é¢„è§ˆã€äº‘ç«¯ä¿å­˜å’Œå¤šæ ¼å¼å¯¼å‡ºã€‚

[![Next.js](https://img.shields.io/badge/Next.js-15.5-black)](https://nextjs.org/)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.5-blue)](https://www.typescriptlang.org/)
[![Neon](https://img.shields.io/badge/Neon-PostgreSQL-green)](https://neon.tech/)
[![Mermaid](https://img.shields.io/badge/Mermaid-11-ff3670)](https://mermaid.js.org/)

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- ğŸ¨ **å®æ—¶ç¼–è¾‘å™¨** - Monaco Editor æ”¯æŒï¼Œè¯­æ³•é«˜äº®å’Œè‡ªåŠ¨è¡¥å…¨
- ğŸ‘ï¸ **å®æ—¶é¢„è§ˆ** - å³æ—¶æ¸²æŸ“ Mermaid å›¾è¡¨
- ğŸ’¾ **äº‘ç«¯ä¿å­˜** - è‡ªåŠ¨ä¿å­˜åˆ° Neon PostgreSQL æ•°æ®åº“
- ğŸ“‘ **æ¨¡æ¿åº“** - å†…ç½®å¤šç§å›¾è¡¨æ¨¡æ¿ï¼ˆæµç¨‹å›¾ã€åºåˆ—å›¾ã€ç±»å›¾ç­‰ï¼‰
- ğŸ”— **åˆ†äº«åŠŸèƒ½** - ç”Ÿæˆåˆ†äº«é“¾æ¥ï¼Œæ”¯æŒå…¬å¼€/ç§å¯†æ¨¡å¼
- ğŸ“Š **Dashboard** - ç®¡ç†æ‰€æœ‰å›¾è¡¨ï¼Œæ”¯æŒæœç´¢å’Œç­›é€‰

### å¢å¼ºåŠŸèƒ½
- âŒ¨ï¸ **é”®ç›˜å¿«æ·é”®** - ä¿å­˜ã€å¯¼å‡ºã€æ–°å»ºç­‰å¿«æ·æ“ä½œï¼ˆCtrl+Sã€Ctrl+Eã€Ctrl+Nï¼‰
- ğŸ“¤ **å¤šæ ¼å¼å¯¼å‡º** - æ”¯æŒ PNGã€SVGã€PDF æ ¼å¼
- ğŸ” **æœç´¢è¿‡æ»¤** - å¿«é€ŸæŸ¥æ‰¾å›¾è¡¨
- â†©ï¸ **æ’¤é”€/é‡åš** - ç¼–è¾‘å†å²ç®¡ç†ï¼ˆCtrl+Z / Ctrl+Yï¼‰

### ç”¨æˆ·è®¤è¯
- ğŸ” **Neon Auth** - å®‰å…¨çš„ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- ğŸ‘¤ **ç”¨æˆ·ç®¡ç†** - æ³¨å†Œã€ç™»å½•ã€é€€å‡ºç™»å½•

### æ”¯æŒçš„å›¾è¡¨ç±»å‹
- æµç¨‹å›¾ (Flowcharts)
- åºåˆ—å›¾ (Sequence Diagrams)
- ç±»å›¾ (Class Diagrams)
- ER å›¾ (ER Diagrams)
- ç”˜ç‰¹å›¾ (Gantt Charts)
- é¥¼å›¾ (Pie Charts)
- ç”¨æˆ·æ—…ç¨‹å›¾ (User Journey)
- æ€ç»´å¯¼å›¾ (Mind Maps)
- Git å›¾ (Git Graphs)

## ğŸ—ï¸ æŠ€æœ¯æ ˆ

| åˆ†ç±» | æŠ€æœ¯ |
|------|------|
| **æ¡†æ¶** | Next.js 15.5.10 (App Router) |
| **è¯­è¨€** | TypeScript 5.5 |
| **æ•°æ®åº“** | Neon PostgreSQL (Serverless) |
| **ORM** | Drizzle ORM |
| **è®¤è¯** | Neon Auth (Better Auth) |
| **ç¼–è¾‘å™¨** | Monaco Editor |
| **å›¾è¡¨** | Mermaid.js 11 |
| **æ ·å¼** | Tailwind CSS |
| **éƒ¨ç½²** | Cloudflare Workers / Pages |

## ğŸ“ é¡¹ç›®ç»“æ„

```
mermaid-better/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/              # Next.js App Router é¡µé¢
â”‚   â”‚   â”œâ”€â”€ api/          # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ dashboard/    # ä»ªè¡¨æ¿é¡µé¢
â”‚   â”‚   â”œâ”€â”€ editor/       # ç¼–è¾‘å™¨é¡µé¢
â”‚   â”‚   â”œâ”€â”€ login/        # ç™»å½•é¡µé¢
â”‚   â”‚   â”œâ”€â”€ register/     # æ³¨å†Œé¡µé¢
â”‚   â”‚   â”œâ”€â”€ share/        # åˆ†äº«é¡µé¢
â”‚   â”‚   â””â”€â”€ templates/    # æ¨¡æ¿é¡µé¢
â”‚   â”œâ”€â”€ components/       # React ç»„ä»¶
â”‚   â”œâ”€â”€ lib/             # å·¥å…·åº“å’Œé…ç½®
â”‚   â”‚   â””â”€â”€ neon/        # Neon æ•°æ®åº“é…ç½®å’Œ schema
â”‚   â””â”€â”€ utils/           # å·¥å…·å‡½æ•°
â”œâ”€â”€ scripts/             # æ•°æ®åº“è„šæœ¬
â”‚   â”œâ”€â”€ check-templates.ts
â”‚   â””â”€â”€ seed-templates.ts
â”œâ”€â”€ tests/               # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ docs/                # é¡¹ç›®æ–‡æ¡£
â”‚   â””â”€â”€ DEPLOYMENT.md    # éƒ¨ç½²æŒ‡å—
â”œâ”€â”€ drizzle/             # Drizzle è¿ç§»æ–‡ä»¶
â”œâ”€â”€ .env                 # ç¯å¢ƒå˜é‡ï¼ˆæœ¬åœ°ï¼‰
â”œâ”€â”€ .dev.vars            # Wrangler ç¯å¢ƒå˜é‡ï¼ˆæœ¬åœ°ï¼‰
â”œâ”€â”€ drizzle.config.ts    # Drizzle é…ç½®
â”œâ”€â”€ next.config.js       # Next.js é…ç½®
â”œâ”€â”€ open-next.config.ts  # OpenNext Cloudflare é…ç½®
â”œâ”€â”€ wrangler.jsonc       # Cloudflare Workers é…ç½®
â””â”€â”€ package.json         # é¡¹ç›®ä¾èµ–
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Node.js 22+
- pnpm 8+
- Neon PostgreSQL æ•°æ®åº“è´¦å·
- Cloudflare è´¦å·ï¼ˆéƒ¨ç½²ç”¨ï¼‰

### å®‰è£…ä¾èµ–

```bash
pnpm install
```

### é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ `.env.example` åˆ° `.env` å¹¶å¡«å…¥ä½ çš„é…ç½®ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```env
# Neon Auth URL
NEXT_PUBLIC_NEON_AUTH_URL=your_neon_auth_url

# Neon Data API URL
NEXT_PUBLIC_NEON_DATA_API_URL=your_neon_data_api_url

# Database Connection String (with pooler)
DATABASE_URL=postgresql://...@...-pooler.neon.tech/...

# App URL
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

### åˆå§‹åŒ–æ•°æ®åº“

```bash
# ç”Ÿæˆ schema
pnpm run db:generate

# æ¨é€åˆ°æ•°æ®åº“
pnpm run db:push

# (å¯é€‰) å¡«å……æ¨¡æ¿æ•°æ®
pnpm tsx scripts/seed-templates.ts
```

### å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
pnpm dev
```

è®¿é—® http://localhost:3000

## ğŸ“– ä½¿ç”¨æŒ‡å—

### åˆ›å»ºç¬¬ä¸€ä¸ªå›¾è¡¨

1. **æ³¨å†Œè´¦å·** - åœ¨é¦–é¡µç‚¹å‡»æ³¨å†Œ
2. **æ–°å»ºå›¾è¡¨** - Dashboard ä¸­ç‚¹å‡» "æ–°å»ºå›¾è¡¨"
3. **ç¼–å†™ä»£ç ** - å·¦ä¾§ç¼–è¾‘å™¨è¾“å…¥ Mermaid ä»£ç 
4. **å®æ—¶é¢„è§ˆ** - å³ä¾§å®æ—¶æ˜¾ç¤ºæ¸²æŸ“ç»“æœ
5. **ä¿å­˜å›¾è¡¨** - å¡«å†™æ ‡é¢˜å¹¶ä¿å­˜

### Mermaid ä»£ç ç¤ºä¾‹

```mermaid
graph TD
    A[å¼€å§‹] --> B{åˆ¤æ–­æ¡ä»¶}
    B -->|æ˜¯| C[æ‰§è¡Œæ“ä½œ]
    B -->|å¦| D[ç»“æŸ]
    C --> D
```

### å¯¼å‡ºå›¾è¡¨

åœ¨ç¼–è¾‘å™¨ä¸­å¯ä»¥ï¼š
- **å¯¼å‡ºä¸º PNG** - é€‚åˆæ–‡æ¡£å’Œæ¼”ç¤º
- **å¯¼å‡ºä¸º SVG** - å¯ç¼©æ”¾çŸ¢é‡å›¾
- **å¯¼å‡ºä¸º PDF** - é€‚åˆæ‰“å°
- **å¤åˆ¶ä»£ç ** - ç”¨äº Markdown æ–‡ä»¶

## ğŸ“¦ æ„å»ºå’Œéƒ¨ç½²

### æ–¹å¼ 1: Cloudflare Workers (æ¨è)

```bash
# 1. æ„å»º Workers ç‰ˆæœ¬
pnpm run build:worker

# 2. é…ç½® secrets
npx wrangler secret put DATABASE_URL
npx wrangler secret put NEXT_PUBLIC_APP_URL

# 3. éƒ¨ç½²
pnpm run deploy:worker
```

è¯¦ç»†æ­¥éª¤è§ [docs/DEPLOYMENT.md](docs/DEPLOYMENT.md)

### æ–¹å¼ 2: Cloudflare Pages

åœ¨ Cloudflare Pages Dashboard é…ç½®ï¼š

```
Framework preset: Next.js
Build command: pnpm run build
Build output directory: .next
Root directory: /
```

æ·»åŠ ç¯å¢ƒå˜é‡åéƒ¨ç½²ã€‚è¯¦è§ [docs/DEPLOYMENT.md](docs/DEPLOYMENT.md)

### æ ‡å‡† Next.js æ„å»º

```bash
pnpm run build
pnpm start
```

## ğŸ§ª æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰ UI æµ‹è¯•
node tests/test-all-ui.js

# æµ‹è¯•ç‰¹å®šåŠŸèƒ½
node tests/test-app.js
node tests/test-templates.js
node tests/test-sharing.js
node tests/test-phase7-features.js
```

## ğŸ“ å¯ç”¨å‘½ä»¤

```bash
# å¼€å‘
pnpm dev              # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev:worker       # å¯åŠ¨ Workers å¼€å‘æœåŠ¡å™¨
pnpm preview:worker   # é¢„è§ˆ Workers æ„å»º

# æ„å»º
pnpm build            # æ ‡å‡† Next.js æ„å»º
pnpm build:worker     # Workers æ„å»º

# éƒ¨ç½²
pnpm deploy:worker    # éƒ¨ç½²åˆ° Cloudflare Workers

# æ•°æ®åº“
pnpm db:generate      # ç”Ÿæˆ Drizzle schema
pnpm db:push          # æ¨é€åˆ°æ•°æ®åº“
pnpm db:migrate       # è¿è¡Œè¿ç§»
pnpm db:studio        # æ‰“å¼€ Drizzle Studio

# ä»£ç è´¨é‡
pnpm lint             # è¿è¡Œ ESLint
pnpm format           # æ ¼å¼åŒ–ä»£ç  (Prettier)
pnpm format:check     # æ£€æŸ¥æ ¼å¼
```

## âŒ¨ï¸ é”®ç›˜å¿«æ·é”®

| å¿«æ·é”® | åŠŸèƒ½ |
|--------|------|
| `Ctrl/Cmd + S` | ä¿å­˜å›¾è¡¨ |
| `Ctrl/Cmd + E` | å¯¼å‡ºä¸º PNG |
| `Ctrl/Cmd + N` | æ–°å»ºå›¾è¡¨ |
| `Ctrl/Cmd + Z` | æ’¤é”€ |
| `Ctrl/Cmd + Y` | é‡åš |
| `Ctrl/Cmd + Shift + Z` | é‡åš (å¤‡ç”¨) |

## ğŸ—ºï¸ API æ–‡æ¡£

### å›¾è¡¨ API

#### `GET /api/diagrams`
è·å–å½“å‰ç”¨æˆ·çš„æ‰€æœ‰å›¾è¡¨

#### `POST /api/diagrams`
åˆ›å»ºæ–°å›¾è¡¨
```json
{
  "title": "æˆ‘çš„æµç¨‹å›¾",
  "content": "graph TD\nA-->B",
  "type": "flowchart",
  "description": "å¯é€‰æè¿°"
}
```

#### `GET /api/diagrams/:id`
è·å–æŒ‡å®šå›¾è¡¨

#### `PATCH /api/diagrams/:id`
æ›´æ–°å›¾è¡¨
```json
{
  "title": "æ›´æ–°çš„æ ‡é¢˜",
  "content": "graph TD\nA-->B-->C"
}
```

#### `DELETE /api/diagrams/:id`
åˆ é™¤å›¾è¡¨

#### `POST /api/diagrams/:id/share`
ç”Ÿæˆåˆ†äº«é“¾æ¥
```json
{
  "isPublic": true
}
```

### æ¨¡æ¿ API

#### `GET /api/templates`
è·å–æ‰€æœ‰å…¬å¼€æ¨¡æ¿

#### `GET /api/templates/:id`
è·å–æŒ‡å®šæ¨¡æ¿

## ğŸ“š æ–‡æ¡£

- [éƒ¨ç½²æŒ‡å—](docs/DEPLOYMENT.md) - Cloudflare Workers å’Œ Pages éƒ¨ç½²

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. åˆ›å»º Pull Request

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ™ è‡´è°¢

- [Next.js](https://nextjs.org/) - React æ¡†æ¶
- [Mermaid.js](https://mermaid.js.org/) - å¼ºå¤§çš„å›¾è¡¨åº“
- [Neon](https://neon.tech/) - Serverless PostgreSQL
- [Cloudflare](https://www.cloudflare.com/) - è¾¹ç¼˜è®¡ç®—å¹³å°
- [Monaco Editor](https://microsoft.github.io/monaco-editor/) - VS Code ç¼–è¾‘å™¨
- [Drizzle ORM](https://orm.drizzle.team/) - TypeScript ORM

---

**ç”¨ â¤ï¸ æ„å»º | Powered by Next.js, Mermaid.js, and Neon**
